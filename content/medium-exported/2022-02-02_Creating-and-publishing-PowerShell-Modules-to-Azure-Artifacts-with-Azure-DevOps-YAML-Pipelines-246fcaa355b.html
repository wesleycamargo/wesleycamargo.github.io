<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Creating and publishing PowerShell Modules to Azure Artifacts with Azure DevOps YAML Pipelines</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Creating and publishing PowerShell Modules to Azure Artifacts with Azure DevOps YAML Pipelines</h1>
</header>
<section data-field="subtitle" class="p-summary">
PowerShell Modules are very useful and can save a lot of time if well designed and created. Check on this post how to create and pack a…
</section>
<section data-field="body" class="e-content">
<section name="1370" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="be81" id="be81" class="graf graf--h3 graf--leading graf--title">Creating and publishing PowerShell Modules to Azure Artifacts with Azure DevOps YAML Pipelines</h3><p name="ec9a" id="ec9a" class="graf graf--p graf-after--h3">PowerShell Modules are very useful and can save a lot of time if well designed and created. Check on this post how to create and pack a basic PowerShell Module, and publish it into Azure Artifact using Azure DevOps YAML Pipelines.</p><figure name="e81d" id="e81d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*fsn7lNWadvhhO4YLZ_YTxQ.jpeg" data-width="3600" data-height="2400" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*fsn7lNWadvhhO4YLZ_YTxQ.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@trnavskauni?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@trnavskauni?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Trnava University</a> on <a href="https://unsplash.com/s/photos/artifact?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/s/photos/artifact?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure><h3 name="cdc9" id="cdc9" class="graf graf--h3 graf-after--figure">Creating PowerShell Module and PowerShell Module Manifest</h3><h4 name="107b" id="107b" class="graf graf--h4 graf-after--h3">Creating a PowerShell Module - psm1</h4><p name="dd65" id="dd65" class="graf graf--p graf-after--h4">A PowerShell Module is a way to organize and pack a set of PowerShell components to be reused or shared. The most common components to be shared are functions.</p><p name="5dad" id="5dad" class="graf graf--p graf-after--p">In this example, we will create the module <code class="markup--code markup--p-code">Example.Module</code> with the extension <code class="markup--code markup--p-code">psm1</code> , and include a PowerShell function.</p><figure name="ebb1" id="ebb1" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/wesleycamargo/a1b041398788429dfc45c603cf4be9f4?file=Example.Module.psm1.js"></script></figure><h4 name="0ae8" id="0ae8" class="graf graf--h4 graf-after--figure">Creating a PowerShell Module Manifest - psd1</h4><p name="5306" id="5306" class="graf graf--p graf-after--h4">To create the Module Manifest, it is possible to run the cmdlet <code class="markup--code markup--p-code">New-ModuleManifest</code> . It will generate the <code class="markup--code markup--p-code">psd1</code> manifest file with default configurations.</p><p name="906e" id="906e" class="graf graf--p graf-after--p">The most important variables are <code class="markup--code markup--p-code">NestedModules</code> and <code class="markup--code markup--p-code">RootModule</code> which must contain the name of the psm1 file.</p><figure name="913e" id="913e" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/wesleycamargo/a1b041398788429dfc45c603cf4be9f4?file=Example.Module.psd1.js"></script></figure><h4 name="bcbe" id="bcbe" class="graf graf--h4 graf-after--figure">Creating a nuspec file for the PowerShell Module</h4><p name="1738" id="1738" class="graf graf--p graf-after--h4">To create the nuspec file you need to run the command <code class="markup--code markup--p-code">nuget spec Example.Module</code> . It will generate a base file that it is possible to replace with your values.</p><figure name="fccf" id="fccf" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/wesleycamargo/a1b041398788429dfc45c603cf4be9f4?file=Example.Module.nuspec.js"></script></figure><h4 name="d416" id="d416" class="graf graf--h4 graf-after--figure">Making the PowerShell Module version dynamic</h4><p name="124f" id="124f" class="graf graf--p graf-after--h4">In both <code class="markup--code markup--p-code">psm1</code>(1) and <code class="markup--code markup--p-code">nuspec</code> (2) files there is a variable <code class="markup--code markup--p-code">$(version)</code> . This variable will be replaced by the version defined in the deployment pipeline. It uses the <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;tabs=yaml%2Cbatch#understand-variable-syntax" data-href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;tabs=yaml%2Cbatch#understand-variable-syntax" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Azure DevOps macro syntax</a> to consume the variables.</p><figure name="18e7" id="18e7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hC2Fp7Sq3dAcnFCrOSfRSA.png" data-width="719" data-height="394" src="https://cdn-images-1.medium.com/max/800/1*hC2Fp7Sq3dAcnFCrOSfRSA.png"><figcaption class="imageCaption">Image by author</figcaption></figure><figure name="58ba" id="58ba" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*TOn6t_70pay-LOgPYJVjAg.png" data-width="852" data-height="285" src="https://cdn-images-1.medium.com/max/800/1*TOn6t_70pay-LOgPYJVjAg.png"><figcaption class="imageCaption">Image by author</figcaption></figure><h3 name="f51f" id="f51f" class="graf graf--h3 graf-after--figure">Creating an Azure Artifacts Feed</h3><p name="2ee6" id="2ee6" class="graf graf--p graf-after--h3">For instructions on how to create a feed, you can check this post where I also show how to push a dotnet Core package to Azure Artifacts:</p><p name="1d5f" id="1d5f" class="graf graf--p graf-after--p"><a href="https://camargo-wes.medium.com/how-to-send-net-core-nuget-packages-to-azure-artifacts-238fa08db6b5" data-href="https://camargo-wes.medium.com/how-to-send-net-core-nuget-packages-to-azure-artifacts-238fa08db6b5" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">How to send .Net Core NuGet packages to Azure Artifacts | by Wesley Camargo | Medium</a></p><h3 name="f821" id="f821" class="graf graf--h3 graf-after--p">Deploying PowerShell Module with Azure DevOps YAML Pipeline into Azure Artifact</h3><h4 name="51f9" id="51f9" class="graf graf--h4 graf-after--h3">Version Number to update PowerShell Module</h4><p name="7ffa" id="7ffa" class="graf graf--p graf-after--h4">To simplify this example, we will provide the version number of the module by Azure DevOps parameter(1). Then we populate a variable with the value of the parameter using template expression syntax(2). In a future post, I will how to bump this number automatically.</p><figure name="68a5" id="68a5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ntWVJnMc2jpUqLegnE_fkw.png" data-width="517" data-height="244" src="https://cdn-images-1.medium.com/max/800/1*ntWVJnMc2jpUqLegnE_fkw.png"><figcaption class="imageCaption">Image by author</figcaption></figure><h4 name="60fd" id="60fd" class="graf graf--h4 graf-after--figure">Replacing version number in nuspec and module manifest</h4><p name="2491" id="2491" class="graf graf--p graf-after--h4">The next step is to replace the variable <code class="markup--code markup--p-code">$(version)</code> mentioned above with the version number. To do it will be used the <a href="https://marketplace.visualstudio.com/items?itemName=qetza.replacetokens" data-href="https://marketplace.visualstudio.com/items?itemName=qetza.replacetokens" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">replace token task</a>. Note that we specify the extensions of the manifest and nuspec files.</p><figure name="6a42" id="6a42" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xMkiWFVlx2G_UJ_M6-pinQ.png" data-width="503" data-height="359" src="https://cdn-images-1.medium.com/max/800/1*xMkiWFVlx2G_UJ_M6-pinQ.png"><figcaption class="imageCaption">Image by author</figcaption></figure><h4 name="e4a0" id="e4a0" class="graf graf--h4 graf-after--figure">Packing PowerShell Module with NuGet</h4><p name="d2f7" id="d2f7" class="graf graf--p graf-after--h4">To pack the module is used the NuGetCommand task, and specified the nuspec file. After generating the NuGet package it will be published as a pipeline artifact - be careful not to confuse with Azure Artifacts, we are almost there but not yet :) - which will be consumed in the next stage: deployment.</p><figure name="2cbe" id="2cbe" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RNGcd5bStLWiDOzCSIUTpA.png" data-width="653" data-height="251" src="https://cdn-images-1.medium.com/max/800/1*RNGcd5bStLWiDOzCSIUTpA.png"><figcaption class="imageCaption">Image by author</figcaption></figure><h4 name="3393" id="3393" class="graf graf--h4 graf-after--figure">Pushing PowerShell Module to Azure Artifacts</h4><p name="a0fd" id="a0fd" class="graf graf--p graf-after--h4">Finally, in the deployment stage, we will push our package into our Azure Artifacts. It will also use the NuGet Command task to push it, sending the <code class="markup--code markup--p-code">nupkg</code> generate in the build stage. It is also necessary to provide the name of the Azure Artifacts Feed.</p><figure name="9adb" id="9adb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8L4ufhKDW1GtuEU_gsEPyQ.png" data-width="1024" data-height="365" src="https://cdn-images-1.medium.com/max/800/1*8L4ufhKDW1GtuEU_gsEPyQ.png"><figcaption class="imageCaption">Image by author</figcaption></figure><h4 name="5a79" id="5a79" class="graf graf--h4 graf-after--figure">Complete azure-pipelines.yml to publish PowerShell Modules to Azure Artifacts</h4><figure name="9a22" id="9a22" class="graf graf--figure graf--iframe graf-after--h4"><script src="https://gist.github.com/wesleycamargo/a1b041398788429dfc45c603cf4be9f4?file=azure-pipelines.yml.js"></script></figure><figure name="8653" id="8653" class="graf graf--figure graf-after--figure"><a href="https://faun.to/bP1m5" data-href="https://faun.to/bP1m5" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="1*BCiLLad3dvZLwBa-B5cAVQ.png" data-width="1500" data-height="200" src="https://cdn-images-1.medium.com/max/800/1*BCiLLad3dvZLwBa-B5cAVQ.png"></a></figure><p name="3652" id="3652" class="graf graf--p graf-after--figure">Join FAUN: <a href="https://faun.to/i9Pt9" data-href="https://faun.to/i9Pt9" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Website</strong></a><strong class="markup--strong markup--p-strong"> </strong>💻<strong class="markup--strong markup--p-strong">|</strong><a href="https://faun.dev/podcast" data-href="https://faun.dev/podcast" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Podcast</strong></a><strong class="markup--strong markup--p-strong"> </strong>🎙️<strong class="markup--strong markup--p-strong">|</strong><a href="https://twitter.com/joinfaun" data-href="https://twitter.com/joinfaun" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Twitter</strong></a><strong class="markup--strong markup--p-strong"> </strong>🐦<strong class="markup--strong markup--p-strong">|</strong><a href="https://www.facebook.com/faun.dev/" data-href="https://www.facebook.com/faun.dev/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Facebook</strong></a><strong class="markup--strong markup--p-strong"> </strong>👥<strong class="markup--strong markup--p-strong">|</strong><a href="https://instagram.com/fauncommunity/" data-href="https://instagram.com/fauncommunity/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Instagram</strong></a><strong class="markup--strong markup--p-strong"> </strong>📷|<a href="https://www.facebook.com/groups/364904580892967/" data-href="https://www.facebook.com/groups/364904580892967/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Facebook Group</strong></a><strong class="markup--strong markup--p-strong"> </strong>🗣️<strong class="markup--strong markup--p-strong">|</strong><a href="https://www.linkedin.com/company/faundev" data-href="https://www.linkedin.com/company/faundev" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Linkedin Group</strong></a><strong class="markup--strong markup--p-strong"> </strong>💬<strong class="markup--strong markup--p-strong">|</strong> <a href="https://faun.dev/chat" data-href="https://faun.dev/chat" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Slack</strong></a> 📱<strong class="markup--strong markup--p-strong">|</strong><a href="https://thechief.io" data-href="https://thechief.io" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Cloud Native</strong> <strong class="markup--strong markup--p-strong">News</strong></a><strong class="markup--strong markup--p-strong"> </strong>📰<strong class="markup--strong markup--p-strong">|</strong><a href="https://linktr.ee/faun.dev/" data-href="https://linktr.ee/faun.dev/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">More</strong></a><strong class="markup--strong markup--p-strong">.</strong></p><p name="3062" id="3062" class="graf graf--p graf-after--p graf--trailing"><strong class="markup--strong markup--p-strong">If this post was helpful, please click the clap 👏 button below a few times to show your support for the author 👇</strong></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@camargo-wes" class="p-author h-card">Wesley Camargo</a> on <a href="https://medium.com/p/246fcaa355b"><time class="dt-published" datetime="2022-02-02T23:02:46.474Z">February 2, 2022</time></a>.</p><p><a href="https://medium.com/@camargo-wes/creating-and-publishing-powershell-modules-to-azure-artifacts-with-azure-devops-yaml-pipelines-246fcaa355b" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 5, 2025.</p></footer></article></body></html>