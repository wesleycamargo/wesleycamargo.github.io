<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Azure Data Factory CI-CD made simple: Building and deploying ARM templates with Azure DevOps YAML…</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Azure Data Factory CI-CD made simple: Building and deploying ARM templates with Azure DevOps YAML…</h1>
</header>
<section data-field="subtitle" class="p-summary">
The easiest way to publish/deploy Azure Data Factory artifacts
</section>
<section data-field="body" class="e-content">
<section name="f4e8" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1c9e" id="1c9e" class="graf graf--h3 graf--leading graf--title">Azure Data Factory CI-CD made simple: Building and deploying ARM templates with Azure DevOps YAML Pipelines</h3><h4 name="03ef" id="03ef" class="graf graf--h4 graf-after--h3 graf--subtitle">The easiest way to publish/deploy Azure Data Factory artifacts</h4></div><div class="section-inner sectionLayout--outsetColumn"><figure name="a7b4" id="a7b4" class="graf graf--figure graf--layoutOutsetCenter graf-after--h4"><img class="graf-image" data-image-id="1*qv6J2hpyUpXE7hkrBu-KjA.jpeg" data-width="3205" data-height="2404" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*qv6J2hpyUpXE7hkrBu-KjA.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@andreasfelske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@andreasfelske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Andreas Felske</a> on <a href="https://unsplash.com/photos/9GwMIek9jnY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/photos/9GwMIek9jnY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="0f41" id="0f41" class="graf graf--p graf-after--figure">If you work with Azure Data Factory, you probably noticed that the deployment process for this tool is unique. It is different from an API or website deployment as it generates ARM Templates and certainly at some point in time questioned “Why is so difficult to deploy it?”. Well, it doesn’t have to be…</p><h3 name="8e3b" id="8e3b" class="graf graf--h3 graf-after--p">Data Factory CI/CD — the old (and problematic) flow</h3><p name="ddc2" id="ddc2" class="graf graf--p graf-after--h3">Azure Data Factory is a great orchestration tool for the Big Data process. It has many integrations and capabilities that make the Data Engineer life very easy.</p><p name="90dc" id="90dc" class="graf graf--p graf-after--p">Although when we talk about deployments there are some tricks, for example, the <strong class="markup--strong markup--p-strong">publish button </strong>inside the workspace, that is necessary to generate the ARM Templates to be deployed. Also, there is no deployment into the development environment, as you are already working there as an editor tool. This process’s a kind different comparing to other “traditional developments”, and this <strong class="markup--strong markup--p-strong">manual step </strong>sends shivers down DevOps engineers spines:</p><figure name="9ff0" id="9ff0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*gb7Xo3KGFPcICqWn.png" data-width="862" data-height="643" src="https://cdn-images-1.medium.com/max/800/0*gb7Xo3KGFPcICqWn.png"><figcaption class="imageCaption">Deployment from Azure Data Factory Workspace — Image from <a href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment-improvements#current-cicd-flow" data-href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment-improvements#current-cicd-flow" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Microsoft Docs</a></figcaption></figure><p name="8ddf" id="8ddf" class="graf graf--p graf-after--figure">It often creates discussions and “workarounds” to deal with this manual step. In some solutions, people move the generate ARM Templates from the adf_publish manually to the feature branch and create a new commit. In others, there is an integration using more than one repo, but again, start the deployment should be - again - a manual step.</p><p name="e587" id="e587" class="graf graf--p graf-after--p">On the older approach, the best solution from my point of view is to deploy using Azure Powershell, but it creates additional complexity as you need to control manually all elements that should be deployed, like linked services and pipelines.</p><h3 name="2972" id="2972" class="graf graf--h3 graf-after--p">Data Factory CI/CD — the new (and much better) flow</h3><p name="95cc" id="95cc" class="graf graf--p graf-after--h3">Fortunately, there is a new way to generate the ARM templates to be deployed, and you don’t need the workarounds mentioned above.</p><p name="dedf" id="dedf" class="graf graf--p graf-after--p">In this strategy, you basically validate and “build” your Data Factory JSON files into ARM Templates ready to be used. To make it work, you need to create a build pipeline and consume the <a href="https://www.npmjs.com/package/@microsoft/azure-data-factory-utilities" data-href="https://www.npmjs.com/package/@microsoft/azure-data-factory-utilities" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ADFUtilities NPM package</a>. This is much cleaner and the manual steps disappear :).</p><figure name="92c8" id="92c8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*ROmkuAm2NMqLXJmH.png" data-width="977" data-height="654" src="https://cdn-images-1.medium.com/max/800/0*ROmkuAm2NMqLXJmH.png"><figcaption class="imageCaption">Deployment with new Azure Data Factory flow — Image from <a href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment-improvements#the-new-cicd-flow" data-href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment-improvements#the-new-cicd-flow" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Microsoft Docs</a></figcaption></figure><p name="a160" id="a160" class="graf graf--p graf-after--figure graf--trailing">For more information, check the official documentation <a href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment-improvements" data-href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment-improvements" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p></div></div></section><section name="7d30" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9ec2" id="9ec2" class="graf graf--h3 graf--leading">How to Create Azure Data Factory using IaC</h3><h4 name="00ca" id="00ca" class="graf graf--h4 graf-after--h3">Infrastructure as Code</h4><p name="8f6d" id="8f6d" class="graf graf--p graf-after--h4">There are tons of reasons to use IaC in your projects, as you can check <a href="https://docs.microsoft.com/en-us/devops/deliver/what-is-infrastructure-as-code#:~:text=Infrastructure%20as%20Code%20enables%20DevOps,to%20prevent%20common%20deployment%20issues." data-href="https://docs.microsoft.com/en-us/devops/deliver/what-is-infrastructure-as-code#:~:text=Infrastructure%20as%20Code%20enables%20DevOps,to%20prevent%20common%20deployment%20issues." class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>. One of them is that Infrastructure as Code is the easiest and fast way to implement your environment. So, as we want to keep our ADF deployment simple, why not use it :)?</p><p name="9243" id="9243" class="graf graf--p graf-after--p">In this example, I will use <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview" data-href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Bicep </a>templates to deploy our Data Factory. If Bicep is new to you, it is basically a DSL (Domain Specific Language) to make things easier for ARM Templates users.</p><figure name="d9ac" id="d9ac" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*UxUKOY8oNniMGGHd.png" data-width="652" data-height="165" src="https://cdn-images-1.medium.com/max/800/0*UxUKOY8oNniMGGHd.png"><figcaption class="imageCaption">Bicep is has a good extension for VS Code— Image from <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/install#development-environment" data-href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/install#development-environment" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Microsoft Docs</a></figcaption></figure><p name="6ace" id="6ace" class="graf graf--p graf-after--figure">In this <a href="https://camargo-wes.medium.com/dataops-automation-creating-azure-data-factory-with-git-integration-using-bicep-376fd3b5bc81" data-href="https://camargo-wes.medium.com/dataops-automation-creating-azure-data-factory-with-git-integration-using-bicep-376fd3b5bc81" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">post</a>, you can check how to create the Bicep file for Data Factory with git integration that will be used to deploy the ADF.</p><p name="7b6b" id="7b6b" class="graf graf--p graf-after--p graf--trailing">It will create a link between your Azure Data Factory and your git repo (it works on Azure DevOps and GitHub), so when you create a pipeline in your Data Factory, it will also be versioned into the git repo.</p></div></div></section><section name="a153" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b731" id="b731" class="graf graf--h3 graf--leading">Git Repository</h3><h4 name="ffe1" id="ffe1" class="graf graf--h4 graf-after--h3">Repository Structure</h4><p name="8a83" id="8a83" class="graf graf--p graf-after--h4">The repo structure will depend on each project. One of the best practices is to keep all necessary code to deploy a project in the same repo. Due to that, I like to create a structure where I have the name of the component, and always an “src” folder underneath. In this case, we will make the src folder as “Root folder” in the git integration process.</p><figure name="1f12" id="1f12" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*YtAqSUP9bqM4NyrMgs3UIw.png" data-width="454" data-height="143" src="https://cdn-images-1.medium.com/max/800/1*YtAqSUP9bqM4NyrMgs3UIw.png"><figcaption class="imageCaption">Repository Structure — Image by author</figcaption></figure><h4 name="368c" id="368c" class="graf graf--h4 graf-after--figure">Required files to build ARM Templates</h4><p name="fc44" id="fc44" class="graf graf--p graf-after--h4">Some files are necessary to have in our repo to generate the templates. These files need to be added to the src folder, and they will be referenced during the build stage.</p><p name="85f7" id="85f7" class="graf graf--p graf-after--p">In the src folder create the file package.json. It contains the metadata of the package that will be used to build the ADF Artifacts.</p><figure name="88a6" id="88a6" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/wesleycamargo/b8ffbdca84f7c364248e04c4649806fc?file=package.json.js"></script></figure><p name="6a4c" id="6a4c" class="graf graf--p graf-after--figure">In the same folder also create the file publish_config.json with the content below. It will not impact the generation of the ARM Templates, but it’s necessary to run the build:</p><figure name="0425" id="0425" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/wesleycamargo/b8ffbdca84f7c364248e04c4649806fc?file=publish_config.json.js"></script></figure><p name="58f7" id="58f7" class="graf graf--p graf-after--figure">The last file is arm-template-parameters-definition.json. This contains the definitions of your ARM Parameters. I won’t go into details, as it requires a dedicated post for it. For the initial version, you can just create the content below:</p><figure name="a163" id="a163" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/wesleycamargo/b8ffbdca84f7c364248e04c4649806fc?file=arm-template-parameters-definition.json.js"></script></figure><p name="d700" id="d700" class="graf graf--p graf-after--figure">After create git integrate and all necessary files this is how your repo will look like:</p><figure name="bc28" id="bc28" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*xesC9GvPVvyOeHafv6EvXg.png" data-width="622" data-height="384" src="https://cdn-images-1.medium.com/max/800/1*xesC9GvPVvyOeHafv6EvXg.png"><figcaption class="imageCaption">Repository structure for Azure Data Factory — Image by author</figcaption></figure></div></div></section><section name="3b93" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="2688" id="2688" class="graf graf--h3 graf--leading">How to create Build YAML Pipelines for Azure Data Factory</h3><p name="a13c" id="a13c" class="graf graf--p graf-after--h3">No doubt that pipeline as code will be the future of pipeline definitions, with the capacity to be under version control and reusability.</p><h4 name="f62f" id="f62f" class="graf graf--h4 graf-after--p">Variables</h4><p name="7f5b" id="7f5b" class="graf graf--p graf-after--h4">The first configuration that is necessary is the variables. They will be used both for build and release later on.</p><p name="9a91" id="9a91" class="graf graf--p graf-after--p">The most important variables during the build stage are:</p><ol class="postList"><li name="b317" id="b317" class="graf graf--li graf-after--p">workingDir - This is the src directory. There must be the required files mentioned above.</li><li name="00fa" id="00fa" class="graf graf--li graf-after--li">dataFactoryResourceId - Fill this with the resource Id of your ADF. It’s a good idea to make it parametrizable to work in different environments</li></ol><figure name="410b" id="410b" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*Y8FG1YgQAtQCCysOutYifw.png" data-width="1515" data-height="261" src="https://cdn-images-1.medium.com/max/800/1*Y8FG1YgQAtQCCysOutYifw.png"><figcaption class="imageCaption">Build and Deployment Variables — Image by author</figcaption></figure><h4 name="93bd" id="93bd" class="graf graf--h4 graf-after--figure">Building Data Factory</h4><p name="8df9" id="8df9" class="graf graf--p graf-after--h4">As mentioned above, we need to consume the <a href="https://www.npmjs.com/package/@microsoft/azure-data-factory-utilities" data-href="https://www.npmjs.com/package/@microsoft/azure-data-factory-utilities" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ADFUtilities NPM package</a> in the build process.</p><p name="c2d2" id="c2d2" class="graf graf--p graf-after--p">In the first two tasks, NodeJS is configured in the build agent. Pay attention to workingDir variable that we mentioned in the Variables section.</p><p name="6d22" id="6d22" class="graf graf--p graf-after--p">In the latest two tasks, we are calling the NPM package to Validate and “Build” our Data Factory and Generate the ARM Templates. In the last task “artifacts” is the relative output directory. It means that it will be the output directory to the ARM Templates.</p><figure name="528d" id="528d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hxff1a4SfxpSRAKGjak-7A.png" data-width="1527" data-height="865" src="https://cdn-images-1.medium.com/max/800/1*hxff1a4SfxpSRAKGjak-7A.png"><figcaption class="imageCaption">Build tasks for Azure Data Factory — Image by author</figcaption></figure><p name="154a" id="154a" class="graf graf--p graf-after--figure">In the next tasks, we are copying the ARM Templates from the output to the staging directory, and “building“ the bicep files into ARM Templates. These ones will be used to create the Azure Data Factory Workspace.</p><figure name="358a" id="358a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*FzU20QATViUliVFKaujdlw.png" data-width="1522" data-height="773" src="https://cdn-images-1.medium.com/max/800/1*FzU20QATViUliVFKaujdlw.png"><figcaption class="imageCaption">Build tasks for Azure Data Factory — Image by author</figcaption></figure><p name="9ad4" id="9ad4" class="graf graf--p graf-after--figure">After running the build pipeline, you will have the artifacts that will be consumed during the deployment stage:</p><figure name="3c7a" id="3c7a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xLM1sqP0zF8ToLhmWy84bA.png" data-width="1223" data-height="683" src="https://cdn-images-1.medium.com/max/800/1*xLM1sqP0zF8ToLhmWy84bA.png"><figcaption class="imageCaption">Azure Data Factory artifacts — Image by author</figcaption></figure><figure name="3484" id="3484" class="graf graf--figure graf-after--figure graf--trailing"><img class="graf-image" data-image-id="1*KokLuIz66bVH_C8D9MqvGA.png" data-width="773" data-height="726" src="https://cdn-images-1.medium.com/max/800/1*KokLuIz66bVH_C8D9MqvGA.png"><figcaption class="imageCaption">Azure Data Factory ARM Templates — Image by author</figcaption></figure></div></div></section><section name="8814" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="aab7" id="aab7" class="graf graf--h3 graf--leading">How to create Release YAML Pipelines for Azure Data Factory</h3><p name="d5fb" id="d5fb" class="graf graf--p graf-after--h3">To deploy Data Factory we are using the run Once strategy. It will consume the artifacts created on the build stage</p><h4 name="2edb" id="2edb" class="graf graf--h4 graf-after--p">Development</h4><p name="1011" id="1011" class="graf graf--p graf-after--h4">When the git integration is enabled in development environment, as the code is produced in the workspace, there is no need to publish in this environment. It will deploy only the environment using the Infrastructure as Code templates. It also contains a dependency for the build stage.</p><figure name="f9b7" id="f9b7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*1CyHziX8HIxTiFKWd1AHJw.png" data-width="1332" data-height="905" src="https://cdn-images-1.medium.com/max/800/1*1CyHziX8HIxTiFKWd1AHJw.png"><figcaption class="imageCaption">Development environment — Image by author</figcaption></figure><h4 name="709f" id="709f" class="graf graf--h4 graf-after--figure">UAT and Production</h4><p name="4f1a" id="4f1a" class="graf graf--p graf-after--h4">In UAT we have a dependency on the development environment. In Production, the dependency is on UAT. As in these stages, we need to deploy both, infrastructure and code, we will use a preDeploy and deploy job:</p><figure name="a6a4" id="a6a4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*H7fXBNZIabhKW5BEoxT2Lw.png" data-width="695" data-height="496" src="https://cdn-images-1.medium.com/max/800/1*H7fXBNZIabhKW5BEoxT2Lw.png"><figcaption class="imageCaption">preDeploy stage — Image by author</figcaption></figure><figure name="e7ec" id="e7ec" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*TK9afdqzBDdiE2m1791joQ.png" data-width="1595" data-height="460" src="https://cdn-images-1.medium.com/max/800/1*TK9afdqzBDdiE2m1791joQ.png"><figcaption class="imageCaption">deploy stage — Image by Author</figcaption></figure><p name="e14b" id="e14b" class="graf graf--p graf-after--figure">When run it will first create the Infrastructure using the Bicep files in the preDeploy Stage, and then deploy the artifacts generated on the build stage. And this is the final result:</p><figure name="cd7b" id="cd7b" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*D1TW--IjWUMr1c-TR5CNYQ.png" data-width="1047" data-height="345" src="https://cdn-images-1.medium.com/max/800/1*D1TW--IjWUMr1c-TR5CNYQ.png"><figcaption class="imageCaption">Deployment Pipeline — Image by Author</figcaption></figure></div></div></section><section name="116e" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5e2a" id="5e2a" class="graf graf--h3 graf--leading">Key Takeaways</h3><p name="9594" id="9594" class="graf graf--p graf-after--h3">There is more than one strategy to deploy Azure Data Factory, I have tried most of them and they work very well, but this one from my point of view is the simplest and clean way to achieve fully automated deployments.</p><p name="692a" id="692a" class="graf graf--p graf-after--p">Below you can check the complete YAML used to deploy it. You can also check other Azure DevOps YAML Templates examples in my GitHub repo: <a href="https://github.com/devopsnights/azuredevops-yaml-quickstart-templates" data-href="https://github.com/devopsnights/azuredevops-yaml-quickstart-templates" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">devopsnights/azuredevops-yaml-quickstart-templates (github.com)</a></p><p name="0fd2" id="0fd2" class="graf graf--p graf-after--p">I hope it can be useful!</p><figure name="bde1" id="bde1" class="graf graf--figure graf--iframe graf-after--p graf--trailing"><script src="https://gist.github.com/wesleycamargo/b8ffbdca84f7c364248e04c4649806fc?file=azure-pipelines.yml.js"></script></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@camargo-wes" class="p-author h-card">Wesley Camargo</a> on <a href="https://medium.com/p/30c30595afa5"><time class="dt-published" datetime="2021-08-13T16:24:55.251Z">August 13, 2021</time></a>.</p><p><a href="https://medium.com/@camargo-wes/azure-data-factory-ci-cd-made-simple-building-and-deploying-your-arm-templates-with-azure-devops-30c30595afa5" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 5, 2025.</p></footer></article></body></html>